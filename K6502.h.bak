/*===================================================================*/
/*                                                                   */
/*  K6502.h : Header file for K6502                                  */
/*                                                                   */
/*  2000/05/29  InfoNES Project ( based on pNesX )                   */
/*                                                                   */
/*===================================================================*/

#ifndef K6502_H_INCLUDED
#define K6502_H_INCLUDED

// Type definition
//#ifndef DWORD
//typedef unsigned long  DWORD;
//#endif
//
//#ifndef WORD
//typedef unsigned short WORD;
//#endif
//
//#ifndef BYTE
//typedef unsigned char  BYTE;
//#endif

#ifndef NULL
#define NULL 0
#endif

/* 6502 Flags */	//PSW
#define FLAG_C 0x01
#define FLAG_Z 0x02
#define FLAG_I 0x04
#define FLAG_D 0x08
#define FLAG_B 0x10
#define FLAG_R 0x20
#define FLAG_V 0x40
#define FLAG_N 0x80

/* Stack Address */
#define BASE_STACK   0x100

/* Interrupt Vectors */
#define VECTOR_NMI   0xfffa
#define VECTOR_RESET 0xfffc
#define VECTOR_IRQ   0xfffe

//// NMI Request
//#define NMI_REQ  NMI_State = 0;
//
//// IRQ Request
//#define IRQ_REQ  IRQ_State = 0;

// Emulator Operation
#ifndef killsystem
void K6502_Init();
#endif /* killsystem */

void K6502_Reset();
//void K6502_Set_Int_Wiring( BYTE byNMI_Wiring, BYTE byIRQ_Wiring );
void K6502_Step( WORD wClocks );

//nesterJ
void K6502_NMI();

// I/O Operation (User definition)
//static inline BYTE K6502_Read( WORD wAddr );
//static inline WORD K6502_ReadW( WORD wAddr );
//static inline WORD K6502_ReadW2( WORD wAddr );
//static inline BYTE K6502_ReadZp( BYTE byAddr );
//static inline WORD K6502_ReadZpW( BYTE byAddr );
//static inline BYTE K6502_ReadAbsX();
//static inline BYTE K6502_ReadAbsY();
//static inline BYTE K6502_ReadIY();

//加速
//static inline BYTE K6502_ReadPC( WORD wAddr );

#ifndef killif
static inline BYTE K6502_ReadIO( WORD wAddr );

#ifdef writeIO
static inline void K6502_WriteIO( WORD wAddr, BYTE byData );
#else
static inline void K6502_WritePPU( WORD wAddr, BYTE byData );
static inline void K6502_WriteAPU( WORD wAddr, BYTE byData );
#endif /* writeIO */

#endif /* killif */


//static inline BYTE ROMBANK0_Read ( WORD wAddr );
//static inline BYTE ROMBANK1_Read ( WORD wAddr );
//static inline BYTE ROMBANK2_Read ( WORD wAddr );
//static inline BYTE ROMBANK3_Read ( WORD wAddr );

//static inline void K6502_Write( WORD wAddr, BYTE byData );
//static inline void K6502_WriteW( WORD wAddr, WORD wData );

//// The state of the IRQ pin
//extern BYTE IRQ_State;
//
//// The state of the NMI pin
//extern BYTE NMI_State;

// The number of the clocks that it passed
extern unsigned int g_dwPassedClocks;

extern DWORD total_cycles;


#if PocketNES == 1
/*register */extern BYTE *nes_pc;			//为了避免每次读取一个指令时就判断一次指令的位置，参考PocketNES中的汇编代码，引入指向指令的指针
extern BYTE *lastbank;
#define encodePC lastbank = memmap_tbl[ ((WORD)nes_pc) >> 13 ]; nes_pc = lastbank + (WORD)nes_pc
#else
extern WORD PC;
#endif

extern BYTE nes_SP;
extern BYTE nes_F;
extern int nes_A;
extern BYTE nes_X;
extern BYTE nes_Y;


/* The address of 8Kbytes unit of the ROM */
//#define ROMPAGE(a)     ( ROM + (a) * 0x2000 )
#define ROMPAGE(a)     ( ROM + ( (a) << 13 ) )
///* From behind the ROM, the address of 8kbytes unit */
//#define ROMLASTPAGE(a) &ROM[ NesHeader.byRomSize * 0x4000 - ( (a) + 1 ) * 0x2000 ]
/* The address of 1Kbytes unit of the VROM */
//#define VROMPAGE(a)    ( VROM + (a) * 0x400 )
#define VROMPAGE(a)    ( VROM + ( (a) << 10 ) )

void Map0_Write( WORD wAddr, BYTE byData );
void Map2_Write( WORD wAddr, BYTE byData );
void Map3_Write( WORD wAddr, BYTE byData );



#endif /* !K6502_H_INCLUDED */
